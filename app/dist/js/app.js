!function(e){function t(r){if(n[r])return n[r].exports;var a=n[r]={exports:{},id:r,loaded:!1};return e[r].call(a.exports,a,a.exports,t),a.loaded=!0,a.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}var a=n(12),o=r(a),i=n(2),s=r(i),c=n(3),u=r(c),l=new o["default"],h=new s["default"](Tetris.config.rowsCount,Tetris.config.colsCount),f=500,_=60;Tetris.init=function(){l.init(Tetris.config.rowsCount,Tetris.config.colsCount,Tetris.config.blockSize,Tetris.config.blocksUrl,Tetris.config.backgroundUrl,Tetris.stageReady)},Tetris.stageReady=function(){function e(e){if(!e.paused){var r=Date.now();if(r-t>n&&!h.isGameOver){var a=h.currentShape;h.canMove(a.x,a.y+1,a.state)?a.moveDown():(h.attachShape(a),h.setNextShape(),l.score=h.score,l.drawShapePreview(h.nextShape)),t=r}l.drawGameBoard(h.gameData),l.drawShape(h.currentShape),l.update(),h.isGameOver&&Tetris.onGameOver()}}var t=0,n=f-100*Tetris.config.speed+100;h.initGame(),l.drawShapePreview(h.nextShape),createjs.Ticker.setFPS(_),createjs.Ticker.addEventListener("tick",e),u["default"].init(h,l)},Tetris.onGameOver=function(){l.showGameOver(),l.update(),createjs.Ticker.paused=!0},window.onload=Tetris.init},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(){n(this,e),this._states=[],this._currentState=0,this._color=0,this._x=0,this._y=0}return r(e,[{key:"moveDown",value:function(){this._y+=1}},{key:"moveLeft",value:function(){this._x-=1}},{key:"moveRight",value:function(){this._x+=1}},{key:"rotate",value:function(){this._currentState-=1,this._currentState<0&&(this._currentState=this._states.length-1)}},{key:"nextState",get:function(){var e=this._currentState-1;return 0>e&&(e=this._states.length-1),this._states[e]}},{key:"x",get:function(){return this._x}},{key:"y",get:function(){return this._y}},{key:"color",get:function(){return this._color}},{key:"state",get:function(){return this._states[this._currentState]}}]),e}();t["default"]=a},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),s=r(i),c=function(){function e(t,n){a(this,e),this._gameData=null,this._currentShape=null,this._nextShape=null,this._shapeGenerator=new s["default"],this._score=0,this._isGameOver=!1,this._rows=t,this._cols=n}return o(e,[{key:"initGame",value:function(){if(null===this._gameData){this._gameData=[];for(var e=0;e<this._rows;e++){this._gameData[e]=[];for(var t=0;t<this._cols;t++)this._gameData[e].push(0)}}else for(var e=0;e<this._rows;e++){this._gameData[e]=[];for(var t=0;t<this._cols;t++)this._gameData[e][t]=0}this._isGameOver=!1,this._currentShape=this._shapeGenerator.getShape(),this._nextShape=this._shapeGenerator.getShape(),this._score=0}},{key:"canMove",value:function(e,t,n){for(var r=!0,a=e,o=t,i=0,s=n.length;s>i;i++){for(var c=0,u=n[i].length;u>c;c++)(0>a||a>this._cols)&&(r=!1,i=s,c=u),void 0!==this._gameData[o]&&0!==this._gameData[o][a]&&void 0!==n[i]&&0!==n[i][c]&&(r=!1,i=s,c=u),a+=1;a=e,o+=1,o>this._rows&&(r=!1,i=s)}return r}},{key:"setNextShape",value:function(){this._currentShape=this._nextShape,this._nextShape=this._shapeGenerator.getShape()}},{key:"attachShape",value:function(e){for(var t=null,n=null,r=e.x,a=e.y,o=0,i=e.state.length;i>o;o++){t=e.state[o];for(var s=0,c=t.length;c>s;s++)n=t[s],0!==n&&a>=0&&(this._gameData[a][r]=e.color),r+=1;r=e.x,a+=1}this._checkLines(),e.y<0&&(this._isGameOver=!0)}},{key:"_checkLines",value:function(){for(var e=!0,t=!1,n=this._rows-1,r=this._cols-1;n>=0;){for(;r>=0;)0===this._gameData[n][r]&&(e=!1,r=-1),r--;e&&(this._clearRow(n),n++,t=!0,this._score+=10),e=!0,r=this._cols-1,n--}}},{key:"_clearRow",value:function(e){for(var t=e,n=0;t>=0;){for(;n<this._cols;)t>0?this._gameData[t][n]=this._gameData[t-1][n]:this._gameData[t][n]=0,n++;n=0,t--}}},{key:"gameData",get:function(){return this._gameData}},{key:"currentShape",get:function(){return this._currentShape}},{key:"isGameOver",get:function(){return this._isGameOver}},{key:"score",get:function(){return this._score}},{key:"nextShape",get:function(){return this._nextShape}}]),e}();t["default"]=c},function(e,t){"use strict";var n=37,r=39,a=38,o=40,i=function(e,t){document.onkeydown=function(i){i||(i=window.event),i.preventDefault();var s=e.currentShape;if(e.isGameOver!==!0)switch(i.keyCode){case n:e.canMove(s.x-1,s.y,s.state)&&s.moveLeft();break;case r:e.canMove(s.x+1,s.y,s.state)&&s.moveRight();break;case a:e.canMove(s.x,s.y,s.nextState)&&s.rotate();break;case o:e.canMove(s.x,s.y+1,s.state)&&s.moveDown()}else e.initGame(),t.score=e.score,t.drawShapePreview(e.nextShape),t.hideGameOver(),createjs.Ticker.paused=!1}};e.exports={init:i}},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(7),s=r(i),c=n(6),u=r(c),l=n(9),h=r(l),f=n(11),_=r(f),p=n(10),d=r(p),v=n(5),y=r(v),b=n(8),g=r(b),w=null,m=7,S=0,k=1,O=2,j=3,x=4,C=5,P=function(){function e(){return a(this,e),w||(w=this),w}return o(e,[{key:"getShape",value:function(){var e=new h["default"],t=Math.floor(Math.random()*m);switch(t){case S:e=new s["default"];break;case k:e=new u["default"];break;case O:e=new g["default"];break;case j:e=new y["default"];break;case x:e=new d["default"];break;case C:e=new _["default"]}return e}}]),e}();t["default"]=P},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=n(1),c=r(s),u=[[1],[1],[1],[1]],l=[[1,1,1,1]],h=function(e){function t(){a(this,t);var e=o(this,Object.getPrototypeOf(t).call(this));return e._states=[u,l],e._currentState=Math.floor(Math.random()*e._states.length),e._color=2,e._x=4,e._y=-1*e._states[e._currentState].length,e}return i(t,e),t}(c["default"]);t["default"]=h},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=n(1),c=r(s),u=[[0,1],[0,1],[1,1]],l=[[1,1,1],[0,0,1]],h=[[1,1],[1,0],[1,0]],f=[[1,0,0],[1,1,1]],_=function(e){function t(){a(this,t);var e=o(this,Object.getPrototypeOf(t).call(this));return e._states=[u,l,h,f],e._currentState=Math.floor(Math.random()*e._states.length),e._color=1,e._x=4,e._y=-1*e._states[e._currentState].length,e}return i(t,e),t}(c["default"]);t["default"]=_},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=n(1),c=r(s),u=[[1,0],[1,0],[1,1]],l=[[0,0,1],[1,1,1]],h=[[1,1],[0,1],[0,1]],f=[[1,1,1],[1,0,0]],_=function(e){function t(){a(this,t);var e=o(this,Object.getPrototypeOf(t).call(this));return e._states=[u,l,h,f],e._currentState=Math.floor(Math.random()*e._states.length),e._color=4,e._x=4,e._y=-1*e._states[e._currentState].length,e}return i(t,e),t}(c["default"]);t["default"]=_},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=n(1),c=r(s),u=[[1,1],[1,1]],l=function(e){function t(){a(this,t);var e=o(this,Object.getPrototypeOf(t).call(this));return e._currentState=0,e._states=[u],e._color=7,e._x=4,e._y=-2,e}return i(t,e),t}(c["default"]);t["default"]=l},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=n(1),c=r(s),u=[[0,1,1],[1,1,0]],l=[[1,0],[1,1],[0,1]],h=function(e){function t(){a(this,t);var e=o(this,Object.getPrototypeOf(t).call(this));return e._states=[u,l],e._currentState=Math.floor(Math.random()*e._states.length),e._color=3,e._x=4,e._y=-1*e._states[e._currentState].length,e}return i(t,e),t}(c["default"]);t["default"]=h},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=n(1),c=r(s),u=[[1,1,1],[0,1,0]],l=[[1,0],[1,1],[1,0]],h=[[0,1,0],[1,1,1]],f=[[0,1],[1,1],[0,1]],_=function(e){function t(){a(this,t);var e=o(this,Object.getPrototypeOf(t).call(this));return e._states=[u,l,h,f],e._currentState=Math.floor(Math.random()*e._states.length),e._color=5,e._x=4,e._y=-1*e._states[e._currentState].length,e}return i(t,e),t}(c["default"]);t["default"]=_},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=n(1),c=r(s),u=[[1,1,0],[0,1,1]],l=[[0,1],[1,1],[1,0]],h=function(e){function t(){a(this,t);var e=o(this,Object.getPrototypeOf(t).call(this));return e._states=[u,l],e._currentState=Math.floor(Math.random()*e._states.length),e._color=6,e._x=4,e._y=-1*e._states[e._currentState].length,e}return i(t,e),t}(c["default"]);t["default"]=h},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();Object.defineProperty(t,"__esModule",{value:!0});var a=8,o="Score: {0}",i=function(){function e(){n(this,e),this._stage=new createjs.Stage(document.getElementById("game-stage")),this._blockAssets=null,this._blocks=[],this._blocksContainer=new createjs.Container,this._gameInfoContainer=new createjs.Container,this._previewContainer=new createjs.Container,this._scoreLabel=new createjs.Text("","20px Arial","white"),this._gameOverScreen=new createjs.Container,this._rows=0,this._cols=0,this._blockSize=0,this._bgImgPath="",this._blocksSpritePath=""}return r(e,[{key:"init",value:function(e,t,n,r,a,o){this._bgImgPath=a,this._blocksSpritePath=r,this._blockSize=n,this._rows=e,this._cols=t,this._loadSpritesheet(function(){this._initBlocks(),this._drawBackground(),this._drawGameInfo(),this._stage.addChild(this._blocksContainer),this._drawGameOverScreen(),o()})}},{key:"_initBlocks",value:function(){for(var e=null,t=0;a>t;t++)e=new createjs.Bitmap(createjs.SpriteSheetUtils.extractFrame(this._blockAssets,t)),this._blocks.push(e)}},{key:"_loadSpritesheet",value:function(e){this._blockAssets=new createjs.SpriteSheet({images:[this._blocksSpritePath],frames:{width:this._blockSize,height:this._blockSize,count:a,regX:0,regY:0,spacing:0,margin:0}}),this._blockAssets.addEventListener("error",function(e){console.error("Blocks spritesheet isn't found in "+e.src)}),this._blockAssets.complete||this._blockAssets.addEventListener("complete",e.bind(this))}},{key:"_drawGameInfo",value:function(){this._gameInfoContainer.setBounds(0,0,180,640),this._gameInfoContainer.x=320,this._stage.addChild(this._gameInfoContainer);var e=new createjs.Shape;e.setBounds(0,0,180,640),e.graphics.setStrokeStyle(1).beginStroke("#ffffff").moveTo(1,0).lineTo(1,640),this._gameInfoContainer.addChild(e);var t=new createjs.Text("Next shape:","20px Arial","white");t.set({x:25,y:65}),this._gameInfoContainer.addChild(t),this._scoreLabel.text="Score: 0",this._scoreLabel.set({x:25,y:30}),this._gameInfoContainer.addChild(this._scoreLabel),this._previewContainer.set({x:25,y:115}),this._gameInfoContainer.addChild(this._previewContainer)}},{key:"_drawBackground",value:function(){var e=null,t=new createjs.Shape;if(t.setBounds(0,0,this._stage.canvas.width,this._stage.canvas.height),t.graphics.beginFill("0x000000").drawRect(0,0,this._stage.canvas.width,this._stage.canvas.height),""!==this._bgImgPath)e=new createjs.Bitmap(this._bgImgPath);else{e=new createjs.Container;for(var n=this._blocks[0].clone(),r=null,a=0,o=0,i=0;i<this._rows;i++){for(var s=0;s<this._cols;s++)r=n.clone(),r.x=a,r.y=o,e.addChild(r),a+=this._blockSize;a=0,o+=this._blockSize}}this._stage.addChildAt(t,0),this._stage.addChild(e),this._stage.update()}},{key:"_drawGameOverScreen",value:function(){var e=this._stage.canvas.width,t=this._stage.canvas.height;this._gameOverScreen.setBounds(0,0,e,t);var n=new createjs.Shape;n.setBounds(0,0,e,t),n.graphics.beginFill("0x000000").drawRect(0,0,e,t),n.alpha=.5,this._gameOverScreen.addChild(n);var r=new createjs.Text("GAME OVER","48px Arial","white"),a=r.getBounds(),o=a.width,i=a.height;r.set({x:e/2-o/2,y:t/2-i/2}),this._gameOverScreen.addChild(r),this._gameOverScreen.visible=!1,this._stage.addChild(this._gameOverScreen)}},{key:"showGameOver",value:function(){this._gameOverScreen.visible=!0}},{key:"hideGameOver",value:function(){this._gameOverScreen.visible=!1}},{key:"drawShape",value:function(e){for(var t=null,n=null,r=null,a=e.x,o=e.y,i=0,s=e.state.length;s>i;i++){t=e.state[i];for(var c=0,u=t.length;u>c;c++)n=t[c],0!==n&&o>=0&&(r=this._blocks[e.color].clone(),r.x=a*this._blockSize,r.y=o*this._blockSize,this._blocksContainer.addChild(r)),a+=1;a=e.x,o+=1}}},{key:"drawGameBoard",value:function(e){var t=null,n=null,r=null;this._blocksContainer.removeAllChildren();for(var a=0,o=e.length;o>a;a++){t=e[a];for(var i=0,s=t.length;s>i;i++)n=t[i],0!==n&&(r=this._blocks[n].clone(),r.x=i*this._blockSize,r.y=a*this._blockSize,this._blocksContainer.addChild(r))}}},{key:"drawShapePreview",value:function(e){var t=null,n=null,r=null,a=0,o=0;this._previewContainer.removeAllChildren();for(var i=0,s=e.state.length;s>i;i++){t=e.state[i];for(var c=0,u=t.length;u>c;c++)n=t[c],0!==n&&o>=0&&(r=this._blocks[e.color].clone(),r.x=a*this._blockSize,r.y=o*this._blockSize,this._previewContainer.addChild(r)),a+=1;a=0,o+=1}var l=this._gameInfoContainer.getBounds(),h=l.width,f=this._previewContainer.getBounds(),_=f.width;this._previewContainer.x=h/2-_/2}},{key:"update",value:function(){this._stage.update()}},{key:"score",set:function(e){this._scoreLabel.text=o.replace("{0}",e.toString())}}]),e}();t["default"]=i}]);
//# sourceMappingURL=app.js.map